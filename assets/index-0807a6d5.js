import{r as a,j as e}from"./index-1a87d2e9.js";const E=a.memo(function({headerText:s,handleCloseDialog:c}){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"editScheduleDialogLabel",children:s}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:c})]})})}),j=[{value:45,text:"Академические"},{value:60,text:"Астрономические"}],p=[{value:0,text:"Без перерыва"},{value:5,text:"5 мин"},{value:10,text:"10 мин"},{value:15,text:"15 мин"},{value:20,text:"20 мин"},{value:30,text:"30 мин"}],f=[{value:"",text:"Выберите преподавателя на это время"},{value:"Иванов",text:"Иванов"},{value:"Петров",text:"Петров"},{value:"Смирнов",text:"Смирнов"}],y=[{value:"",text:"Аудитория"},{value:"4-01",text:"4-01"},{value:"4-02",text:"4-02"},{value:"4-03",text:"4-03"},{value:"4-04",text:"4-04"},{value:"4-05",text:"4-05"}],C=a.memo(function({handleCloseDialog:s,handleSubmitBtn:c,submitBtnText:t}){return e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex justify-content-end mt-3",children:[e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn",onClick:s,children:"Отмена"})}),e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn btn-outline-dark",onClick:c,children:t})})]})})}),T=a.memo(function({children:s}){return e.jsx("div",{className:"mt-3 alert alert-danger",role:"alert",children:s})}),b=a.memo(function({options:s,onSelectedOption:c,hideDefaultOption:t=!1}){const[i,o]=a.useState(""),m=l=>{c(l.target.value),o(l.target.value)},d=t?s[0]:null,n=t?s.slice(1):s;return e.jsx("div",{className:"select-container",children:e.jsxs("select",{className:"form-select",value:i,onChange:m,children:[d&&e.jsx("option",{value:"",disabled:!0,hidden:!0,children:d.text}),n.map(l=>e.jsx("option",{value:l.value,children:l.text},l.value))]})})}),h=a.memo(function({onValueChange:s,maxValue:c,step:t,buttonText:i}){const[o,m]=a.useState(0),d=a.useCallback(n=>()=>{const l=o+n;l<0||l>c||m(l)},[c,o]);return a.useEffect(()=>{s(o)},[s,o]),e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:"btn btn-primary",disabled:o<=0,onClick:d(-t),type:"button",children:"-"}),e.jsx("input",{type:"text",className:"form-control text-center",value:o,readOnly:!0}),e.jsx("button",{className:"btn btn-secondary disabled",children:i}),e.jsx("button",{className:"btn btn-primary",disabled:o>=c,onClick:d(t),type:"button",children:"+"})]})}),O=a.memo(function({selWeekdays:s,handleWeekdaysChange:c}){const[t,i]=a.useState(s),o=a.useCallback((n,l)=>{let r;l.target.checked?r=[...t,n]:r=t.filter(x=>x!==n),i(r),c(r)},[t,c]),m=a.useCallback(n=>{let l;n.every(r=>t.includes(r))?l=t.filter(r=>!n.includes(r)):l=[...t.filter(r=>!n.includes(r)),...n],i(l),c(l)},[t,c]),d=a.useMemo(()=>[{id:"mwfbtn",label:"ПН/СР/ПТ",val:[1,3,5]},{id:"tuethubtn",label:"ВТ/ЧТ",val:[2,4]},{id:"monbtn",label:"ПН",val:1},{id:"tuebtn",label:"ВТ",val:2},{id:"wedbtn",label:"СР",val:3},{id:"thubtn",label:"ЧТ",val:4},{id:"fribtn",label:"ПТ",val:5},{id:"satbtn",label:"СБ",val:6},{id:"sanbtn",label:"ВС",val:0}],[]);return e.jsx("div",{className:"btn-group",role:"group","aria-label":"weekdays_group",children:d.map(n=>e.jsxs(a.Fragment,{children:[e.jsx("input",{type:"checkbox",className:"btn-check",id:n.id,autoComplete:"off",onChange:l=>Array.isArray(n.val)?m(n.val):o(n.val,l),checked:Array.isArray(n.val)?n.val.every(l=>t.includes(l)):t.includes(n.val)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:n.id,children:n.label})]},n.id))})}),v=a.memo(function({start:s,end:c,isEditStart:t,type:i,handleTimerChange:o}){return e.jsxs("div",{className:"row gx-0",children:[e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:s,onChange:o,type:i,disabled:!t})}),e.jsx("div",{className:"col-sm-2",children:e.jsx("button",{className:"btn btn-secondary disabled",children:"до"})}),e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:c,type:i,disabled:!0})})]})}),F=a.memo(function({handleValueChange:s,weekdays:c,dateStart:t,dateEnd:i,timeStart:o,timeEnd:m}){const d=a.useRef(null),n=a.useCallback(u=>s("totalHoursValue",u),[s]),l=a.useCallback(u=>s("hoursPerDay",u),[s]),r=a.useCallback(u=>s("hourValue",u),[s]),x=a.useCallback(u=>s("breakType",Number(u)),[s]),N=a.useCallback(u=>s("classroom",u),[s]),k=a.useCallback(u=>s("teacher",u),[s]),S=a.useCallback(u=>s("weekdays",u),[s]),w=a.useCallback(()=>{d.current!==null&&s("groupColor",d.current.value)},[s]),g=a.useCallback(u=>{s("dateStart",u.currentTarget.value)},[s]),D=a.useMemo(()=>e.jsxs(e.Fragment,{children:["Выбор ",e.jsx("strong",{children:"преподавателя"})," и"," ",e.jsx("strong",{children:"аудитории"})," не обязателен."]}),[]);return e.jsx("div",{className:"modal-body",style:{whiteSpace:"pre-line"},children:e.jsxs("form",{children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary disabled",children:"Онлайн школа"}),e.jsxs("div",{className:"d-flex align-items-center ms-3",children:[e.jsx("label",{htmlFor:"colorInput",className:"form-label",children:"Цвет группы:"}),e.jsx("input",{className:"form-control form-control-color ms-2",id:"colorInput",ref:d,type:"color",defaultValue:"#FFFFFF",onChange:w,title:"Choose your color"})]})]})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(b,{options:j,onSelectedOption:r})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{onValueChange:n,maxValue:1e3,step:1,buttonText:"Всего часов"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(v,{start:t,end:i,isEditStart:!0,handleTimerChange:g,type:"date"})})]}),e.jsx("div",{className:"row py-3",children:e.jsx(O,{selWeekdays:c,handleWeekdaysChange:S})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2",children:[e.jsx("div",{className:"col col-md-4",children:e.jsx(b,{options:p,onSelectedOption:x})}),e.jsx("div",{className:"col col-md-4",children:e.jsx(h,{onValueChange:l,maxValue:24,step:.5,buttonText:"Часов в день"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(v,{start:o,end:m,isEditStart:!1,type:"time"})})]}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col col-md-7",children:e.jsx(b,{options:f,onSelectedOption:k,hideDefaultOption:!0})}),e.jsx("div",{className:"col col-md-5",children:e.jsx(b,{options:y,onSelectedOption:N,hideDefaultOption:!0})})]}),e.jsx(T,{children:D})]})})}),I=(s,c,t,i)=>{const[o,m]=t.split(":"),d=s*c,l=Number.parseInt(o)*60+Number.parseInt(m)+d+i,r=Math.floor(l/60).toString().padStart(2,"0"),x=Math.floor(l%60).toString().padStart(2,"0");return`${r}:${x}`},H=(s,c,t,i)=>{if(s>0&&c>0&&i.length>0){const o=new Date(t),m=Math.ceil(s/c),d=[7,1,2,3,4,5,6];let n=o,l=m;for(;l>0;){const r=d[n.getDay()];i.includes(r)&&l--,l>0&&(n=new Date(n.setDate(n.getDate()+1)))}return n.toISOString().slice(0,10)}return new Date().toISOString().slice(0,10)},P=({handleCloseDialog:s})=>{a.useEffect(()=>{const l=r=>{r.key==="Escape"&&s()};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[s]);const c=new Date().toISOString().slice(0,10),[t,i]=a.useState({groupColor:"#FFFFF",totalHoursValue:0,hoursPerDay:0,hourValue:j[0].value,breakType:p[0].value,classroom:y[0].value,teacher:f[0].value,dateStart:c,dateEnd:c,timeStart:"07:00",timeEnd:"07:00",weekdays:[1,3]}),o=a.useCallback((l,r)=>{i(x=>x[l]!==r?{...x,[l]:r}:x)},[]),m=a.useCallback(()=>{console.log(t),s()},[s,t]),d=a.useMemo(()=>I(t.hourValue,t.hoursPerDay,t.timeStart,t.breakType),[t.hourValue,t.hoursPerDay,t.timeStart,t.breakType]);a.useEffect(()=>{o("timeEnd",d)},[d,o]);const n=a.useMemo(()=>H(t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays),[t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays]);return a.useEffect(()=>{o("dateEnd",n)},[o,n]),e.jsx("div",{className:"modal modal-xl fade show",style:{display:"block"},id:"editScheduleDialog","aria-labelledby":"editScheduleDialogLabel",role:"dialog","aria-hidden":!1,children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(E,{headerText:"Редактирование расписания",handleCloseDialog:s}),e.jsx(F,{handleValueChange:o,weekdays:t.weekdays,dateStart:t.dateStart,dateEnd:t.dateEnd,timeStart:t.timeStart,timeEnd:t.timeEnd}),e.jsx(C,{handleCloseDialog:s,handleSubmitBtn:m,submitBtnText:"Добавить расписание"})]})})})};export{P as default};
