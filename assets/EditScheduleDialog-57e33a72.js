import{r,j as e}from"./index-981f2a15.js";const w=r.memo(function({headerText:n,handleCloseDialog:c}){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"editScheduleDialogLabel",children:n}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:c})]})})}),j=[{value:45,text:"Академические"},{value:60,text:"Астрономические"}],f=[{value:0,text:"Без перерыва"},{value:5,text:"5 мин"},{value:10,text:"10 мин"},{value:15,text:"15 мин"},{value:20,text:"20 мин"},{value:30,text:"30 мин"}],y=[{value:"",text:"Выберите преподавателя на это время"},{value:"Иванов",text:"Иванов"},{value:"Петров",text:"Петров"},{value:"Смирнов",text:"Смирнов"}],v=[{value:"",text:"Аудитория"},{value:"4-01",text:"4-01"},{value:"4-02",text:"4-02"},{value:"4-03",text:"4-03"},{value:"4-04",text:"4-04"},{value:"4-05",text:"4-05"}],D=r.memo(function({handleCloseDialog:n,handleSubmitBtn:c,submitBtnText:t}){return e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex justify-content-end mt-3",children:[e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn",onClick:n,children:"Отмена"})}),e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn btn-outline-dark",onClick:c,children:t})})]})})}),E=r.memo(function({children:n}){return e.jsx("div",{className:"mt-3 alert alert-danger",role:"alert",children:n})}),x=r.memo(function({options:n,onSelectedOption:c,hideDefaultOption:t=!1}){const[i,l]=r.useState(""),u=a=>{c(a.target.value),l(a.target.value)},s=t?n[0]:null,o=t?n.slice(1):n;return e.jsx("div",{className:"select-container",children:e.jsxs("select",{className:"form-select",value:i,onChange:u,children:[s&&e.jsx("option",{value:"",disabled:!0,hidden:!0,children:s.text}),o.map(a=>e.jsx("option",{value:a.value,children:a.text},a.value))]})})}),b=r.memo(function({onValueChange:n,maxValue:c,step:t,buttonText:i}){const[l,u]=r.useState(0),s=o=>()=>{const a=l+o;a<0||a>c||u(a)};return r.useEffect(()=>{n(l)},[n,l]),e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:"btn btn-primary",disabled:l<=0,onClick:s(-t),type:"button",children:"-"}),e.jsx("input",{type:"text",className:"form-control text-center",value:l,readOnly:!0}),e.jsx("button",{className:"btn btn-secondary disabled",children:i}),e.jsx("button",{className:"btn btn-primary",disabled:l>=c,onClick:s(t),type:"button",children:"+"})]})}),F=r.memo(function({weekdays:n,handleWeekdaysChange:c}){const[t,i]=r.useState(n),l=(s,o)=>{let a;o.target.checked?a=[...t,s]:a=t.filter(m=>m!==s),i(a),c(a)},u=s=>{let o;s.every(a=>t.includes(a))?o=t.filter(a=>!s.includes(a)):o=[...t.filter(a=>!s.includes(a)),...s],i(o),c(o)};return e.jsxs("div",{className:"btn-group",role:"group","aria-label":"weekdays_group",children:[e.jsx("input",{type:"checkbox",className:"btn-check",id:"mwfbtn",autoComplete:"off",onChange:()=>u([1,3,5]),checked:[1,3,5].every(s=>t.includes(s))}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"mwfbtn",children:"ПН/СР/ПТ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"tuethubtn",autoComplete:"off",onChange:()=>u([2,4]),checked:[2,4].every(s=>t.includes(s))}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"tuethubtn",children:"ВТ/ЧТ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"monbtn",autoComplete:"off",checked:t.includes(1),onChange:s=>l(1,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"monbtn",children:"ПН"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"tuebtn",autoComplete:"off",checked:t.includes(2),onChange:s=>l(2,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"tuebtn",children:"ВТ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"wedbtn",autoComplete:"off",checked:t.includes(3),onChange:s=>l(3,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"wedbtn",children:"СР"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"thubtn",autoComplete:"off",checked:t.includes(4),onChange:s=>l(4,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"thubtn",children:"ЧТ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"fribtn",autoComplete:"off",checked:t.includes(5),onChange:s=>l(5,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"fribtn",children:"ПТ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"satbtn",autoComplete:"off",checked:t.includes(6),onChange:s=>l(6,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"satbtn",children:"СБ"}),e.jsx("input",{type:"checkbox",className:"btn-check",id:"sanbtn",autoComplete:"off",checked:t.includes(0),onChange:s=>l(0,s)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:"sanbtn",children:"ВС"})]})}),p=r.memo(function({start:n,end:c,isEditStart:t,type:i,handleTimerChange:l}){return e.jsxs("div",{className:"row gx-0",children:[e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:n,onChange:l,type:i,disabled:!t})}),e.jsx("div",{className:"col-sm-2",children:e.jsx("button",{className:"btn btn-secondary disabled",children:"до"})}),e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:c,type:i,disabled:!0})})]})}),T=r.memo(function({handleValueChange:n,weekdays:c,dateStart:t,dateEnd:i,timeStart:l,timeEnd:u}){const s=r.useRef(null),o=d=>n("totalHoursValue",d),a=d=>n("hoursPerDay",d),m=d=>n("hourValue",d),h=d=>n("breakType",Number(d)),N=d=>n("classroom",d),k=d=>n("teacher",d),g=d=>n("weekdays",d),S=()=>{s.current!==null&&n("groupColor",s.current.value)},C=d=>{n("dateStart",d.currentTarget.value)};return e.jsx("div",{className:"modal-body",style:{whiteSpace:"pre-line"},children:e.jsxs("form",{children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary disabled",children:"Онлайн школа"}),e.jsxs("div",{className:"d-flex align-items-center ms-3",children:[e.jsx("label",{htmlFor:"colorInput",className:"form-label",children:"Цвет группы:"}),e.jsx("input",{className:"form-control form-control-color ms-2",id:"colorInput",ref:s,type:"color",defaultValue:"#FFFFFF",onChange:S,title:"Choose your color"})]})]})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(x,{options:j,onSelectedOption:m})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{onValueChange:o,maxValue:1e3,step:1,buttonText:"Всего часов"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(p,{start:t,end:i,isEditStart:!0,handleTimerChange:C,type:"date"})})]}),e.jsx("div",{className:"row py-3",children:e.jsx(F,{weekdays:c,handleWeekdaysChange:g})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2",children:[e.jsx("div",{className:"col col-md-4",children:e.jsx(x,{options:f,onSelectedOption:h})}),e.jsx("div",{className:"col col-md-4",children:e.jsx(b,{onValueChange:a,maxValue:1e3,step:.5,buttonText:"Часов в день"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(p,{start:l,end:u,isEditStart:!1,type:"time"})})]}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col col-md-7",children:e.jsx(x,{options:y,onSelectedOption:k,hideDefaultOption:!0})}),e.jsx("div",{className:"col col-md-5",children:e.jsx(x,{options:v,onSelectedOption:N,hideDefaultOption:!0})})]}),e.jsxs(E,{children:["Выбор ",e.jsx("strong",{children:"преподавателя"})," и"," ",e.jsx("strong",{children:"аудитории"})," не обязателен."]})]})})}),O=(n,c,t,i)=>{const[l,u]=t.split(":"),s=n*c,a=Number.parseInt(l)*60+Number.parseInt(u)+s+i,m=Math.floor(a/60).toString().padStart(2,"0"),h=Math.floor(a%60).toString().padStart(2,"0");return`${m}:${h}`},I=(n,c,t,i)=>{if(n>0&&c>0&&i.length>0){const l=new Date(t),u=Math.ceil(n/c),s=[7,1,2,3,4,5,6],o=l;let a=u;if(i.length===0)return l.toISOString().slice(0,10);for(;a>0;){const m=s[o.getDay()%7];i.includes(m)&&a--,o.setDate(o.getDate()+1)}return o.toISOString().slice(0,10)}return new Date().toISOString().slice(0,10)},P=({handleCloseDialog:n})=>{r.useEffect(()=>{const a=m=>{m.key==="Escape"&&n()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[n]);const c=new Date().toISOString().slice(0,10),[t,i]=r.useState({groupColor:"#FFFFF",totalHoursValue:0,hoursPerDay:0,hourValue:j[0].value,breakType:f[0].value,classroom:v[0].value,teacher:y[0].value,dateStart:c,dateEnd:c,timeStart:"07:00",timeEnd:"07:00",weekdays:[1,3]}),l=r.useCallback((a,m)=>{i(h=>h[a]!==m?{...h,[a]:m}:h)},[]),u=r.useCallback(()=>{console.log(t),n()},[n,t]),s=r.useMemo(()=>O(t.hourValue,t.hoursPerDay,t.timeStart,t.breakType),[t.hourValue,t.hoursPerDay,t.timeStart,t.breakType]);r.useEffect(()=>{l("timeEnd",s)},[s,l]);const o=r.useMemo(()=>I(t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays),[t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays]);return r.useEffect(()=>{l("dateEnd",o)},[l,o]),e.jsx("div",{className:"modal modal-xl fade show",style:{display:"block"},id:"editScheduleDialog","aria-labelledby":"editScheduleDialogLabel",role:"dialog","aria-hidden":!1,children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(w,{headerText:"Редактирование расписания",handleCloseDialog:n}),e.jsx(T,{handleValueChange:l,weekdays:t.weekdays,dateStart:t.dateStart,dateEnd:t.dateEnd,timeStart:t.timeStart,timeEnd:t.timeEnd}),e.jsx(D,{handleCloseDialog:n,handleSubmitBtn:u,submitBtnText:"Добавить расписание"})]})})})};export{P as default};
