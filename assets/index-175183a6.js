import{r as o,j as e}from"./index-abc8d7a8.js";const D=o.memo(function({headerText:s,handleCloseDialog:n}){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"editScheduleDialogLabel",children:s}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:n})]})})}),j=[{value:45,text:"Академические"},{value:60,text:"Астрономические"}],p=[{value:0,text:"Без перерыва"},{value:5,text:"5 мин"},{value:10,text:"10 мин"},{value:15,text:"15 мин"},{value:20,text:"20 мин"},{value:30,text:"30 мин"}],f=[{value:"",text:"Выберите преподавателя на это время"},{value:"Иванов",text:"Иванов"},{value:"Петров",text:"Петров"},{value:"Смирнов",text:"Смирнов"}],y=[{value:"",text:"Аудитория"},{value:"4-01",text:"4-01"},{value:"4-02",text:"4-02"},{value:"4-03",text:"4-03"},{value:"4-04",text:"4-04"},{value:"4-05",text:"4-05"}],E=o.memo(function({handleCloseDialog:s,handleSubmitBtn:n,submitBtnText:t}){return e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex justify-content-end mt-3",children:[e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn",onClick:s,children:"Отмена"})}),e.jsx("div",{className:"me-1",children:e.jsx("button",{className:"btn btn-outline-dark",onClick:n,children:t})})]})})}),C=o.memo(function({children:s}){return e.jsx("div",{className:"mt-3 alert alert-danger",role:"alert",children:s})}),x=o.memo(function({options:s,onSelectedOption:n,hideDefaultOption:t=!1}){const[i,c]=o.useState(""),m=l=>{n(l.target.value),c(l.target.value)},d=t?s[0]:null,a=t?s.slice(1):s;return e.jsx("div",{className:"select-container",children:e.jsxs("select",{className:"form-select",value:i,onChange:m,children:[d&&e.jsx("option",{value:"",disabled:!0,hidden:!0,children:d.text}),a.map(l=>e.jsx("option",{value:l.value,children:l.text},l.value))]})})}),b=o.memo(function({onValueChange:s,maxValue:n,step:t,buttonText:i}){const[c,m]=o.useState(0),d=a=>()=>{const l=c+a;l<0||l>n||m(l)};return o.useEffect(()=>{s(c)},[s,c]),e.jsxs("div",{className:"input-group",children:[e.jsx("button",{className:"btn btn-primary",disabled:c<=0,onClick:d(-t),type:"button",children:"-"}),e.jsx("input",{type:"text",className:"form-control text-center",value:c,readOnly:!0}),e.jsx("button",{className:"btn btn-secondary disabled",children:i}),e.jsx("button",{className:"btn btn-primary",disabled:c>=n,onClick:d(t),type:"button",children:"+"})]})}),T=o.memo(function({selWeekdays:s,handleWeekdaysChange:n}){const[t,i]=o.useState(s),c=o.useCallback((a,l)=>{let r;l.target.checked?r=[...t,a]:r=t.filter(h=>h!==a),i(r),n(r)},[t,n]),m=o.useCallback(a=>{let l;a.every(r=>t.includes(r))?l=t.filter(r=>!a.includes(r)):l=[...t.filter(r=>!a.includes(r)),...a],i(l),n(l)},[t,n]),d=o.useMemo(()=>[{id:"mwfbtn",label:"ПН/СР/ПТ",val:[1,3,5]},{id:"tuethubtn",label:"ВТ/ЧТ",val:[2,4]},{id:"monbtn",label:"ПН",val:1},{id:"tuebtn",label:"ВТ",val:2},{id:"wedbtn",label:"СР",val:3},{id:"thubtn",label:"ЧТ",val:4},{id:"fribtn",label:"ПТ",val:5},{id:"satbtn",label:"СБ",val:6},{id:"sanbtn",label:"ВС",val:0}],[]);return e.jsx("div",{className:"btn-group",role:"group","aria-label":"weekdays_group",children:d.map(a=>e.jsxs(o.Fragment,{children:[e.jsx("input",{type:"checkbox",className:"btn-check",id:a.id,autoComplete:"off",onChange:l=>Array.isArray(a.val)?m(a.val):c(a.val,l),checked:Array.isArray(a.val)?a.val.every(l=>t.includes(l)):t.includes(a.val)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:a.id,children:a.label})]},a.id))})}),v=o.memo(function({start:s,end:n,isEditStart:t,type:i,handleTimerChange:c}){return e.jsxs("div",{className:"row gx-0",children:[e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:s,onChange:c,type:i,disabled:!t})}),e.jsx("div",{className:"col-sm-2",children:e.jsx("button",{className:"btn btn-secondary disabled",children:"до"})}),e.jsx("div",{className:"col-sm-5",children:e.jsx("input",{className:"form-control text-center",value:n,type:i,disabled:!0})})]})}),O=o.memo(function({handleValueChange:s,weekdays:n,dateStart:t,dateEnd:i,timeStart:c,timeEnd:m}){const d=o.useRef(null),a=u=>s("totalHoursValue",u),l=u=>s("hoursPerDay",u),r=u=>s("hourValue",u),h=u=>s("breakType",Number(u)),N=u=>s("classroom",u),S=u=>s("teacher",u),w=u=>s("weekdays",u),k=()=>{d.current!==null&&s("groupColor",d.current.value)},g=u=>{s("dateStart",u.currentTarget.value)};return e.jsx("div",{className:"modal-body",style:{whiteSpace:"pre-line"},children:e.jsxs("form",{children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary disabled",children:"Онлайн школа"}),e.jsxs("div",{className:"d-flex align-items-center ms-3",children:[e.jsx("label",{htmlFor:"colorInput",className:"form-label",children:"Цвет группы:"}),e.jsx("input",{className:"form-control form-control-color ms-2",id:"colorInput",ref:d,type:"color",defaultValue:"#FFFFFF",onChange:k,title:"Choose your color"})]})]})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(x,{options:j,onSelectedOption:r})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{onValueChange:a,maxValue:1e3,step:1,buttonText:"Всего часов"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(v,{start:t,end:i,isEditStart:!0,handleTimerChange:g,type:"date"})})]}),e.jsx("div",{className:"row py-3",children:e.jsx(T,{selWeekdays:n,handleWeekdaysChange:w})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2",children:[e.jsx("div",{className:"col col-md-4",children:e.jsx(x,{options:p,onSelectedOption:h})}),e.jsx("div",{className:"col col-md-4",children:e.jsx(b,{onValueChange:l,maxValue:24,step:.5,buttonText:"Часов в день"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(v,{start:c,end:m,isEditStart:!1,type:"time"})})]}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col col-md-7",children:e.jsx(x,{options:f,onSelectedOption:S,hideDefaultOption:!0})}),e.jsx("div",{className:"col col-md-5",children:e.jsx(x,{options:y,onSelectedOption:N,hideDefaultOption:!0})})]}),e.jsxs(C,{children:["Выбор ",e.jsx("strong",{children:"преподавателя"})," и"," ",e.jsx("strong",{children:"аудитории"})," не обязателен."]})]})})}),F=(s,n,t,i)=>{const[c,m]=t.split(":"),d=s*n,l=Number.parseInt(c)*60+Number.parseInt(m)+d+i,r=Math.floor(l/60).toString().padStart(2,"0"),h=Math.floor(l%60).toString().padStart(2,"0");return`${r}:${h}`},I=(s,n,t,i)=>{if(s>0&&n>0&&i.length>0){const c=new Date(t),m=Math.ceil(s/n),d=[7,1,2,3,4,5,6];let a=c,l=m;for(;l>0;){const r=d[a.getDay()];i.includes(r)&&l--,l>0&&(a=new Date(a.setDate(a.getDate()+1)))}return a.toISOString().slice(0,10)}return new Date().toISOString().slice(0,10)},M=({handleCloseDialog:s})=>{o.useEffect(()=>{const l=r=>{r.key==="Escape"&&s()};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[s]);const n=new Date().toISOString().slice(0,10),[t,i]=o.useState({groupColor:"#FFFFF",totalHoursValue:0,hoursPerDay:0,hourValue:j[0].value,breakType:p[0].value,classroom:y[0].value,teacher:f[0].value,dateStart:n,dateEnd:n,timeStart:"07:00",timeEnd:"07:00",weekdays:[1,3]}),c=o.useCallback((l,r)=>{i(h=>h[l]!==r?{...h,[l]:r}:h)},[]),m=o.useCallback(()=>{console.log(t),s()},[s,t]),d=o.useMemo(()=>F(t.hourValue,t.hoursPerDay,t.timeStart,t.breakType),[t.hourValue,t.hoursPerDay,t.timeStart,t.breakType]);o.useEffect(()=>{c("timeEnd",d)},[d,c]);const a=o.useMemo(()=>I(t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays),[t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays]);return o.useEffect(()=>{c("dateEnd",a)},[c,a]),e.jsx("div",{className:"modal modal-xl fade show",style:{display:"block"},id:"editScheduleDialog","aria-labelledby":"editScheduleDialogLabel",role:"dialog","aria-hidden":!1,children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(D,{headerText:"Редактирование расписания",handleCloseDialog:s}),e.jsx(O,{handleValueChange:c,weekdays:t.weekdays,dateStart:t.dateStart,dateEnd:t.dateEnd,timeStart:t.timeStart,timeEnd:t.timeEnd}),e.jsx(E,{handleCloseDialog:s,handleSubmitBtn:m,submitBtnText:"Добавить расписание"})]})})})};export{M as default};
