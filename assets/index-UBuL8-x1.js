import{r as a,j as e,B as b}from"./index-0tUS6Gcw.js";const E=a.memo(function({headerText:s,handleCloseDialog:n}){return e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"editScheduleDialogLabel",children:s}),e.jsx(b,{className:"btn-close","aria-label":"Close",onClick:n,type:"button"})]})}),j=[{value:45,text:"Академические"},{value:60,text:"Астрономические"}],f=[{value:0,text:"Без перерыва"},{value:5,text:"5 мин"},{value:10,text:"10 мин"},{value:15,text:"15 мин"},{value:20,text:"20 мин"},{value:30,text:"30 мин"}],y=[{value:"",text:"Выберите преподавателя на это время"},{value:"Иванов",text:"Иванов"},{value:"Петров",text:"Петров"},{value:"Смирнов",text:"Смирнов"}],k=[{value:"",text:"Аудитория"},{value:"4-01",text:"4-01"},{value:"4-02",text:"4-02"},{value:"4-03",text:"4-03"},{value:"4-04",text:"4-04"},{value:"4-05",text:"4-05"}],T=a.memo(function({handleCloseDialog:s,handleSubmitBtn:n,submitBtnText:t}){return e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"d-flex justify-content-end mt-3",children:[e.jsx("div",{className:"me-1",children:e.jsx(b,{onClick:s,label:"Отмена",type:"button"})}),e.jsx("div",{className:"me-1",children:e.jsx(b,{className:"btn-outline-dark",onClick:n,label:t,type:"submit"})})]})})}),O=a.memo(function({children:s}){return e.jsx("div",{className:"mt-3 alert alert-danger",role:"alert",children:s})}),h=a.memo(function({options:s,onSelectedOption:n,hideDefaultOption:t=!1}){const[d,c]=a.useState(""),m=l=>{n(l.target.value),c(l.target.value)},i=t?s[0]:null,o=t?s.slice(1):s;return e.jsx("div",{className:"select-container",children:e.jsxs("select",{className:"form-select",value:d,onChange:m,children:[i&&e.jsx("option",{value:"",disabled:!0,hidden:!0,children:i.text}),o.map(l=>e.jsx("option",{value:l.value,children:l.text},l.value))]})})}),v=a.memo(function({onValueChange:s,maxValue:n,step:t,buttonText:d}){const[c,m]=a.useState(0),i=a.useCallback(o=>()=>{const l=c+o;l<0||l>n||m(l)},[n,c]);return a.useEffect(()=>{s(c)},[s,c]),e.jsxs("div",{className:"input-group",children:[e.jsx(b,{className:"btn-primary",disabled:c<=0,label:"-",onClick:i(-t),type:"button"}),e.jsx("input",{type:"text",className:"form-control text-center",value:c,readOnly:!0}),e.jsx(b,{className:"btn-secondary",disabled:!0,label:d,type:"button"}),e.jsx(b,{className:"btn-primary",disabled:c>=n,label:"+",onClick:i(t),type:"button"})]})}),F=a.memo(function({selWeekdays:s,handleWeekdaysChange:n}){const[t,d]=a.useState(s),c=a.useCallback((o,l)=>{let r;l.target.checked?r=[...t,o]:r=t.filter(x=>x!==o),d(r),n(r)},[t,n]),m=a.useCallback(o=>{let l;o.every(r=>t.includes(r))?l=t.filter(r=>!o.includes(r)):l=[...t.filter(r=>!o.includes(r)),...o],d(l),n(l)},[t,n]),i=a.useMemo(()=>[{id:"mwfbtn",label:"ПН/СР/ПТ",val:[1,3,5]},{id:"tuethubtn",label:"ВТ/ЧТ",val:[2,4]},{id:"monbtn",label:"ПН",val:1},{id:"tuebtn",label:"ВТ",val:2},{id:"wedbtn",label:"СР",val:3},{id:"thubtn",label:"ЧТ",val:4},{id:"fribtn",label:"ПТ",val:5},{id:"satbtn",label:"СБ",val:6},{id:"sanbtn",label:"ВС",val:0}],[]);return e.jsx("div",{className:"btn-group",role:"group","aria-label":"weekdays_group",children:i.map(o=>e.jsxs(a.Fragment,{children:[e.jsx("input",{type:"checkbox",className:"btn-check",id:o.id,autoComplete:"off",onChange:l=>Array.isArray(o.val)?m(o.val):c(o.val,l),checked:Array.isArray(o.val)?o.val.every(l=>t.includes(l)):t.includes(o.val)}),e.jsx("label",{className:"btn btn-outline-primary",htmlFor:o.id,children:o.label})]},o.id))})}),p=a.memo(function({start:s,end:n,isEditStart:t,type:d,handleTimerChange:c}){return e.jsxs("div",{className:"input-group",children:[e.jsx("input",{className:"form-control text-center",value:s,onChange:c,type:t?d:"text",disabled:!t}),e.jsx(b,{className:"btn-secondary",disabled:!0,label:"до",type:"button"}),e.jsx("input",{className:"form-control text-center",value:n,type:"text",disabled:!0})]})}),I=a.memo(function({handleValueChange:s,weekdays:n,dateStart:t,dateEnd:d,timeStart:c,timeEnd:m}){const i=a.useRef(null),o=a.useCallback(u=>s("totalHoursValue",u),[s]),l=a.useCallback(u=>s("hoursPerDay",u),[s]),r=a.useCallback(u=>s("hourValue",u),[s]),x=a.useCallback(u=>s("breakType",Number(u)),[s]),N=a.useCallback(u=>s("classroom",u),[s]),S=a.useCallback(u=>s("teacher",u),[s]),w=a.useCallback(u=>s("weekdays",u),[s]),D=a.useCallback(()=>{i.current!==null&&s("groupColor",i.current.value)},[s]),g=a.useCallback(u=>{s("dateStart",u.currentTarget.value)},[s]),C=a.useMemo(()=>e.jsxs(e.Fragment,{children:["Выбор ",e.jsx("strong",{children:"преподавателя"})," и"," ",e.jsx("strong",{children:"аудитории"})," не обязателен."]}),[]);return e.jsx("div",{className:"modal-body",style:{whiteSpace:"pre-line"},children:e.jsxs("form",{children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx(b,{className:"btn-outline-primary",disabled:!0,label:"Онлайн школа",type:"button"}),e.jsxs("div",{className:"d-flex align-items-center ms-3",children:[e.jsx("label",{htmlFor:"colorInput",className:"form-label",children:"Цвет группы:"}),e.jsx("input",{className:"form-control form-control-color ms-2",id:"colorInput",ref:i,type:"color",defaultValue:"#FFFFFF",onChange:D,title:"Choose your color"})]})]})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(h,{options:j,onSelectedOption:r})}),e.jsx("div",{className:"col-md-4",children:e.jsx(v,{onValueChange:o,maxValue:1e3,step:1,buttonText:"Всего часов"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(p,{start:t,end:d,isEditStart:!0,handleTimerChange:g,type:"date"})})]}),e.jsx("div",{className:"row py-3",children:e.jsx(F,{selWeekdays:n,handleWeekdaysChange:w})}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2",children:[e.jsx("div",{className:"col col-md-4",children:e.jsx(h,{options:f,onSelectedOption:x})}),e.jsx("div",{className:"col col-md-4",children:e.jsx(v,{onValueChange:l,maxValue:24,step:.5,buttonText:"Часов в день"})}),e.jsx("div",{className:"col-md-4",children:e.jsx(p,{start:c,end:m,isEditStart:!1,type:"time"})})]}),e.jsxs("div",{className:"row row-cols-1 row-cols-sm-2 row-cols-md-2 mt-3",children:[e.jsx("div",{className:"col col-md-7",children:e.jsx(h,{options:y,onSelectedOption:S,hideDefaultOption:!0})}),e.jsx("div",{className:"col col-md-5",children:e.jsx(h,{options:k,onSelectedOption:N,hideDefaultOption:!0})})]}),e.jsx(O,{children:C})]})})}),B=(s,n,t,d)=>{const[c,m]=t.split(":"),i=s*n,l=Number.parseInt(c)*60+Number.parseInt(m)+i+d,r=Math.floor(l/60).toString().padStart(2,"0"),x=Math.floor(l%60).toString().padStart(2,"0");return`${r}:${x}`},H=(s,n,t,d)=>{if(s>0&&n>0&&d.length>0){const c=new Date(t),m=Math.ceil(s/n),i=[7,1,2,3,4,5,6];let o=c,l=m;for(;l>0;){const r=i[o.getDay()];d.includes(r)&&l--,l>0&&(o=new Date(o.setDate(o.getDate()+1)))}return o.toISOString().slice(0,10)}return new Date().toISOString().slice(0,10)},P=({handleCloseDialog:s})=>{a.useEffect(()=>{const l=r=>{r.key==="Escape"&&s()};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[s]);const n=new Date().toISOString().slice(0,10),[t,d]=a.useState({groupColor:"#FFFFF",totalHoursValue:0,hoursPerDay:0,hourValue:j[0].value,breakType:f[0].value,classroom:k[0].value,teacher:y[0].value,dateStart:n,dateEnd:n,timeStart:"07:00",timeEnd:"07:00",weekdays:[1,3]}),c=a.useCallback((l,r)=>{d(x=>x[l]!==r?{...x,[l]:r}:x)},[]),m=a.useCallback(()=>{console.log(t),s()},[s,t]),i=a.useMemo(()=>B(t.hourValue,t.hoursPerDay,t.timeStart,t.breakType),[t.hourValue,t.hoursPerDay,t.timeStart,t.breakType]);a.useEffect(()=>{c("timeEnd",i)},[i,c]);const o=a.useMemo(()=>H(t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays),[t.totalHoursValue,t.hoursPerDay,t.dateStart,t.weekdays]);return a.useEffect(()=>{c("dateEnd",o)},[c,o]),e.jsx("div",{className:"modal modal-xl fade show",style:{display:"block"},id:"editScheduleDialog","aria-labelledby":"editScheduleDialogLabel",role:"dialog","aria-hidden":!1,children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsx(E,{headerText:"Редактирование расписания",handleCloseDialog:s}),e.jsx(I,{handleValueChange:c,weekdays:t.weekdays,dateStart:t.dateStart,dateEnd:t.dateEnd,timeStart:t.timeStart,timeEnd:t.timeEnd}),e.jsx(T,{handleCloseDialog:s,handleSubmitBtn:m,submitBtnText:"Добавить расписание"})]})})})};export{P as default};
